<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>History & Replay - Advanced Echo Server</title>
  <meta name="description" content="Request logging, storage, and replay capabilities for comprehensive testing workflows">
  <link rel="icon" type="image/png" href="favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    .header-img { max-width: 200px; }
    .section { max-width: 1000px; margin: 0 auto; padding: 2rem 1rem; }
    pre { background: #f8fafc; border: 1px solid #e2e8f0; padding: 1rem; border-radius: 8px; overflow-x: auto; font-size: 0.875rem; }
    .mermaid { text-align: center; background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e2e8f0; margin: 1rem 0; }
    .feature-card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin: 1rem 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    table { border-collapse: collapse; width: 100%; margin: 1rem 0; background: white; }
    th, td { border: 1px solid #e2e8f0; padding: 0.75rem; text-align: left; }
    th { background: #f1f5f9; font-weight: 600; }
    .nav-link { display: inline-block; padding: 0.5rem 1rem; margin: 0.25rem; background: #f1f5f9; border-radius: 6px; text-decoration: none; color: #374151; transition: all 0.2s; }
    .nav-link:hover { background: #e5e7eb; }
    .nav-link.active { background: #3b82f6; color: white; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
    <div class="section text-center py-6">
      <img src="/advanced-echo-server/aes.png" alt="Advanced Echo Server" class="header-img mx-auto mb-4">
      <h1 class="text-4xl font-bold mb-2">History & Replay</h1>
      <p class="text-xl">Request logging, storage, and replay capabilities</p>
    </div>
  </header>

  <nav class="bg-white border-b shadow-sm">
    <div class="section flex flex-wrap justify-center py-4">
      <a href="/advanced-echo-server/index.html" class="nav-link">üè† Home</a>
      <a href="/advanced-echo-server/simple-echo.html" class="nav-link">Simple Echo</a>
      <a href="/advanced-echo-server/delays.html" class="nav-link">Delays</a>
      <a href="/advanced-echo-server/back-pressure.html" class="nav-link">Back Pressure</a>
      <a href="/advanced-echo-server/scenarios.html" class="nav-link">Scenarios</a>
      <a href="/advanced-echo-server/custom-responses.html" class="nav-link">Custom Responses</a>
      <a href="/advanced-echo-server/websockets.html" class="nav-link">WebSockets</a>
      <a href="/advanced-echo-server/sse.html" class="nav-link">SSE</a>
      <a href="/advanced-echo-server/history-replay.html" class="nav-link active">History & Replay</a>
      <a href="/advanced-echo-server/observability.html" class="nav-link">Observability</a>
      <a href="/advanced-echo-server/api-reference.html" class="nav-link">API Reference</a>
    </div>
  </nav>

  <main class="section">
    <div class="feature-card">
      <h2 class="text-2xl font-bold mb-4">Request History & Replay</h2>
      <p>Advanced Echo Server maintains a configurable history of recent requests, allowing you to inspect, analyze, and replay past interactions. This feature is essential for debugging, testing, and understanding application behavior patterns.</p>
    </div>

    <section class="mb-8">
      <h3 class="text-xl font-semibold mb-4">How It Works</h3>
      <div class="feature-card">
        <pre class="mermaid">
graph TD
    A[Incoming Request] --> B[Process Request]
    B --> C[Store in History]
    C --> D{History Full?}
    D -->|Yes| E[Remove Oldest]
    D -->|No| F[Keep All]
    E --> F
    F --> G[Return Response]
    
    H[History API] --> I[Retrieve Requests]
    I --> J[Filter & Search]
    J --> K[Return Results]
    
    L[Replay API] --> M[Get Request by ID]
    M --> N[Re-execute Request]
    N --> O[Return New Response]
    
    style A fill:#e1f5fe
    style G fill:#e8f5e8
    style C fill:#fff3e0
    style I fill:#f3e5f5
</pre>
      </div>
    </section>

    <section class="mb-8">
      <h3 class="text-xl font-semibold mb-4">Configuration</h3>
      <div class="feature-card">
        <table>
          <thead>
            <tr>
              <th>Environment Variable</th>
              <th>Description</th>
              <th>Default</th>
              <th>Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>ECHO_HISTORY_SIZE</code></td>
              <td>Maximum number of requests to store</td>
              <td><code>100</code></td>
              <td><code>1000</code></td>
            </tr>
            <tr>
              <td><code>ECHO_HISTORY_ENABLED</code></td>
              <td>Enable/disable request history</td>
              <td><code>true</code></td>
              <td><code>false</code></td>
            </tr>
            <tr>
              <td><code>ECHO_HISTORY_INCLUDE_BODY</code></td>
              <td>Store request/response bodies</td>
              <td><code>true</code></td>
              <td><code>false</code></td>
            </tr>
            <tr>
              <td><code>ECHO_HISTORY_MAX_BODY_SIZE</code></td>
              <td>Maximum body size to store (bytes)</td>
              <td><code>1048576</code></td>
              <td><code>512000</code></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="mb-8">
      <h3 class="text-xl font-semibold mb-4">Viewing Request History</h3>
      <div class="feature-card">
        <p class="mb-4">Retrieve stored requests using the history API endpoint:</p>
        
        <h4 class="font-semibold mb-2">Get All Requests</h4>
        <pre><code># Get all stored requests
curl http://localhost:8080/history

# Response format:
[
  {
    "id": "ab2a11b7d4cfc1c9",
    "timestamp": "2025-09-14T22:53:09.617551-07:00",
    "method": "POST",
    "url": "/api/login",
    "headers": {
      "Accept": [
        "*/*"
      ],
      "Content-Length": [
        "35"
      ],
      "Content-Type": [
        "application/json"
      ],
      "User-Agent": [
        "curl/8.7.1"
      ],
      "X-Request-Id": [
        "ab2a11b7d4cfc1c9"
      ]
    },
    "body": "eyJ1c2VybmFtZSI6Inh5eiIsInBhc3N3b3JkIjoieHl6In0="
  },
  {
    "id": "ab2a11b7d4cfc1c9",
    "timestamp": "2025-09-14T22:53:36.7286-07:00",
    "method": "POST",
    "url": "/api/login",
    "headers": {
      "Accept": [
        "*/*"
      ],
      "Accept-Encoding": [
        "gzip"
      ],
      "Content-Length": [
        "35"
      ],
      "Content-Type": [
        "application/json"
      ],
      "User-Agent": [
        "curl/8.7.1"
      ],
      "X-Request-Id": [
        "ab2a11b7d4cfc1c9"
      ]
    },
    "body": "eyJ1c2VybmFtZSI6Inh5eiIsInBhc3N3b3JkIjoieHl6In0="
  }
]</code></pre>

   </div>
    </section>

    <section class="mb-8">
      <h3 class="text-xl font-semibold mb-4">Request Replay</h3>
      <div class="feature-card">
        <p class="mb-4">Replay previous requests to test behavior changes or debug issues:</p>
        
        <h4 class="font-semibold mb-2">Replay by Request ID</h4>
        <p class="mb-4">Replay a specific request by providing its ID in the JSON body. The server will re-execute the original request and return the new response. The response format is the same as a standard echo response.</p>
        <pre><code># Replay a specific request by providing its ID in the JSON body
curl -X POST http://localhost:8080/replay \
  -H "Content-Type: application/json" \
  -d '{"id": "req_1234567890"}'</code></pre>

        <h4 class="font-semibold mb-2 mt-4">Replay with Modifications</h4>
        <pre><code># Replay with header modifications
curl -X POST http://localhost:8080/replay \
  -H "Content-Type: application/json" \
  -d '{
    "id": "req_1234567890",
    "modify_headers": {
      "X-Test-Environment": "staging",
      "Authorization": "Bearer new-token"
    },
    "modify_body": "{\"name\": \"Jane Doe\"}",
    "target": "http://staging.example.com"
  }'</code></pre>
      </div>
    </section>

    <section>
      <h3 class="text-xl font-semibold mb-4">Best Practices</h3>
      <div class="feature-card">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <h4 class="font-semibold text-blue-800 mb-2">üí° Performance Tips</h4>
          <ul class="text-blue-700 text-sm space-y-1">
            <li>‚Ä¢ Set appropriate history size limits based on memory constraints</li>
            <li>‚Ä¢ Disable body storage for high-volume endpoints if not needed</li>
            <li>‚Ä¢ The history is in-memory and currently has no cleanup or filtering capabilities.</li>
          </ul>
        </div>
        
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4">
          <h4 class="font-semibold text-amber-800 mb-2">‚ö†Ô∏è Security Considerations</h4>
          <ul class="text-amber-700 text-sm space-y-1">
            <li>‚Ä¢ Be cautious with storing sensitive data in request bodies</li>
            <li>‚Ä¢ Consider disabling history for authentication endpoints using the `X-Echo-History-Enabled: false` header.</li>
            <li>‚Ä¢ The `advanced-echo-server` does not have built-in access controls.</li>
          </ul>
        </div>

        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
          <h4 class="font-semibold text-green-800 mb-2">‚úÖ Monitoring</h4>
          <ul class="text-green-700 text-sm space-y-1">
            <li>‚Ä¢ Monitor history storage usage and performance impact</li>
            <li>‚Ä¢ Track replay success rates and response differences</li>
            <li>‚Ä¢ Set up alerts for unusual request patterns</li>
            <li>‚Ä¢ Use metrics to optimize history configuration</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-white text-center py-8">
    <div class="section">
      <p class="mb-2">Advanced Echo Server - Licensed under <a href="https://opensource.org/licenses/MIT" class="text-blue-300 hover:text-blue-200">MIT License</a></p>
      <p class="text-sm text-gray-400">Built with Go ‚Ä¢ Dockerized ‚Ä¢ Production Ready</p>
    </div>
  </footer>

  <script>
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'default',
      themeVariables: {
        primaryColor: '#3b82f6',
        primaryTextColor: '#1e40af',
        primaryBorderColor: '#2563eb',
        lineColor: '#6b7280',
        secondaryColor: '#f3f4f6',
        tertiaryColor: '#f9fafb'
      }
    });
  </script>
</body>
</html>